<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
</style>
<script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCUrsdVrY0c5EIqkrbfI0YduQlFfTG-n18&sensor=true">
</script>
<script type="text/javascript">
		var directionsDisplay;
		var directionsService = new google.maps.DirectionsService();
		var gmap;
		var localLat;
		var localLng;

function calcRoute() {
		var start =  new google.maps.LatLng(localLat, localLng);
		var endLat = {{.Latitude}}; 
		var endLng = {{.Longitude}}; 
		var end = new google.maps.LatLng(endLat, endLng);
		var request = {
			origin: start,
			destination: end,
			travelMode: google.maps.TravelMode.DRIVING
		};
		directionsService.route(request, function(result, status) {
						if (status == google.maps.DirectionsStatus.OK) {
						directionsDisplay.setDirections(result);}
						});
}

function savePosition(position){
		localLng = position.coords.longitude;
		localLat = position.coords.latitude;

		directionsDisplay = new google.maps.DirectionsRenderer();
		var local = new google.maps.LatLng(localLat, localLng);
		var mapOptions = {
		center: local, 
		zoom: 8,
		mapTypeId: google.maps.MapTypeId.ROADMAP
		};

		gmap = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
		directionsDisplay.setMap(gmap);

		var gmarker = new google.maps.Marker({
		position: local,
		map: gmap
		});			
}

function getLocation(){
		if (navigator.geolocation){
				navigator.geolocation.getCurrentPosition(savePosition);
		}else{
				alert("The browser can not support geolocation");
		}
}	
</script>
</head>
<body onload="getLocation()">
		<button onclick="calcRoute()" type="button"> calculate</button> 
		<div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>

