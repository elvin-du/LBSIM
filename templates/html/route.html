<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
</style>
<script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCUrsdVrY0c5EIqkrbfI0YduQlFfTG-n18&sensor=true">
</script>
<script type="text/javascript">
		var directionsDisplay;
		var directionsService = new google.maps.DirectionsService();
		var gmap;
		var localLat;
		var localLng;
		var marker;

function calcRoute() {
		var start =  new google.maps.LatLng(localLat, localLng);
		var endLat = {{.Latitude}}; 
		var endLng = {{.Longitude}}; 
		var end = new google.maps.LatLng(endLat, endLng);
		var request = {
			origin: start,
			destination: end,
			travelMode: google.maps.TravelMode.DRIVING
		};

		directionsService.route(request, showRoute);
};

function showRoute(result,stat){
	if (stat == google.maps.DirectionsStatus.OK){
		path = result.routes[0].overview_path;
		if(path){
				window.setInterval(function(){
								if(!marker){
								marker = new google.maps.Marker({position:path[0], map:gmap});
								}else{
								marker.setPosition(path[0]);
								}
						}, 1);
		}
		
		directionsDisplay = new google.maps.DirectionsRenderer();
		directionsDisplay.setMap(gmap);
		directionsDisplay.setDirections(result);
	}
};

function savePosition(position){
		localLng = position.coords.longitude;
		localLat = position.coords.latitude;
		var local = new google.maps.LatLng(localLat, localLng);
		var mapOptions = {
		center: local, 
		zoom: 18,
		mapTypeId: google.maps.MapTypeId.ROADMAP
		};
		
		gmap = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
		if(!marker){
				marker = new google.maps.Marker({position:local, map:gmap});
		}else{
				marker.setPosition(path[0]);
		}
};

function getLocation(){
		if (navigator.geolocation){
				navigator.geolocation.getCurrentPosition(savePosition);
		}else{
				alert("The browser can not support geolocation");
		}
};

</script>
</head>
<body onload="getLocation()">
		<button onclick="calcRoute()" type="button"> calculate</button> 
		<div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>

